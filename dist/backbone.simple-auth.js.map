{"version":3,"sources":["backbone.simple-auth.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,CAAC,UAAS,IAAI,EAAE,OAAO,EAAE;AACvB,MAAI,OAAO,MAAM,KAAK,UAAU,IAAI,MAAM,CAAC,GAAG,EAAE;AAC9C,UAAM,CAAC,CAAC,UAAU,EAAE,YAAY,CAAC,EAAE,OAAO,CAAC,CAAC;GAC7C,MAAM,IAAI,OAAO,OAAO,KAAK,WAAW,EAAE;AACzC,QAAI,QAAQ,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC;AACnC,QAAI,OAAO,GAAG,OAAO,CAAC,YAAY,CAAC,CAAC;AACpC,UAAM,CAAC,OAAO,GAAG,OAAO,CAAC,QAAQ,EAAE,OAAO,CAAC,CAAC;GAC7C,MAAM;AACL,QAAI,CAAC,UAAU,GAAG,OAAO,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;GACxD;CACF,CAAA,CAAE,IAAI,EAAE,UAAS,QAAQ,EAAE,OAAO,EAAE;AACnC,cAAY,CAAC;;MAKP,UAAU;AASH,aATP,UAAU,GASA;AACZ,iCAVE,UAAU,8CAUH,SAAS,EAAE;AACpB,UAAI,CAAC,aAAa,EAAE,CAAC;AACrB,UAAI,CAAC,cAAc,EAAE,CAAC;KACvB;;cAbG,UAAU;;yBAAV,UAAU;AACV,cAAQ;aAAA,YAAG;AACb,iBAAO;AACL,sBAAU,EAAE,OAAO;AACnB,iBAAK,EAAE,SAAS;AAChB,yBAAa,EAAE,KAAK;WACrB,CAAC;SACH;;;;AASD,mBAAa;;;eAAA,yBAAG;AACd,cAAI,KAAK,GAAG,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;;;AAGhD,cAAI,KAAK,KAAK,WAAW,EAAE;AAAE,iBAAK,GAAG,SAAS,CAAC;WAAE;AACjD,cAAI,CAAC,GAAG,CAAC;AACP,yBAAa,EAAE,CAAC,CAAC,KAAK;AACtB,iBAAK,EAAE,KAAK;WACb,CAAC,CAAC;AACH,cAAI,CAAC,KAAK,EAAE;AAAE,mBAAO;WAAE;AACvB,cAAI,CAAC,OAAO,CAAC,cAAc,EAAE,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;SACjD;;;;;AAGD,YAAM;;;eAAA,kBAAG;AACP,iBAAO,CAAC,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,YAAY,CAAC,CAAC,CAAC;AACvC,cAAI,CAAC,GAAG,CAAC;AACP,iBAAK,EAAE,SAAS;AAChB,yBAAa,EAAE,KAAK;WACrB,CAAC,CAAC;AACH,cAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAC;SACxB;;;;;AAGD,oBAAc;;;eAAA,yBAAG;AACf,cAAI,IAAI,GAAG,IAAI,CAAC;AAChB,kBAAQ,CAAC,CAAC,CAAC,SAAS,CAAC;AACnB,sBAAU,EAAA,oBAAC,KAAK,EAAE;AAChB,kBAAI,IAAI,CAAC,GAAG,CAAC,eAAe,CAAC,EAAE;AAC7B,qBAAK,CAAC,gBAAgB,CAAC,eAAe,EAAE,SAAS,GAAG,IAAI,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC;eACxE;AACD,qBAAO,IAAI,CAAC;aACb;WACF,CAAC,CAAC;SACJ;;;;;;;WAlDG,UAAU;KAAS,QAAQ,CAAC,KAAK;;;;;AAwDvC,UAAQ,CAAC,IAAI,GAAG,UAAU,CAAC;;AAE3B,SAAO,UAAU,CAAC;CACnB,CAAC,CAAC","file":"backbone.simple-auth.js","sourcesContent":["(function(root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    define(['backbone', 'cookies-js'], factory);\n  } else if (typeof exports !== 'undefined') {\n    var Backbone = require('backbone');\n    var cookies = require('cookies-js');\n    module.exports = factory(Backbone, cookies);\n  } else {\n    root.SimpleAuth = factory(root.Backbone, root.cookies);\n  }\n})(this, function(Backbone, cookies) {\n  'use strict';\n\n  import Backbone from 'backbone';\n  import cookies from 'cookies-js';\n  \n  class SimpleAuth extends Backbone.Model {\n    get defaults() {\n      return {\n        cookieName: 'token',\n        token: undefined,\n        authenticated: false\n      };\n    }\n  \n    constructor() {\n      super(...arguments);\n      this.determineAuth();\n      this._configureAjax();\n    }\n  \n    // Determine if we're authenticated based on the cookie\n    determineAuth() {\n      var token = cookies.get(this.get('cookieName'));\n      // Fix for a bug in cookies-js:\n      // https://github.com/ScottHamper/Cookies/issues/37\n      if (token === 'undefined') { token = undefined; }\n      this.set({\n        authenticated: !!token,\n        token: token\n      });\n      if (!token) { return; }\n      this.trigger('authenticate', this.get('token'));\n    }\n  \n    // Log us out by destroying the token\n    logout() {\n      cookies.expire(this.get('cookieName'));\n      this.set({\n        token: undefined,\n        authenticated: false\n      });\n      this.trigger('logout');\n    }\n  \n    // Include our token in every request\n    _configureAjax() {\n      var auth = this;\n      Backbone.$.ajaxSetup({\n        beforeSend(jqXHR) {\n          if (auth.get('authenticated')) {\n            jqXHR.setRequestHeader('Authorization', 'Bearer ' + auth.get('token'));\n          }\n          return true;\n        }\n      });\n    }\n  }\n  \n  export default SimpleAuth;\n  \n\n  Backbone.Auth = SimpleAuth;\n  \n  return SimpleAuth;\n});\n"],"sourceRoot":"/source/"}